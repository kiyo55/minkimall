<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>

<link rel="icon" href="/img/img2/favicon.png" type="image/png">
<title th:text="${product.pname} + ' ìƒì„¸ë³´ê¸°'"></title>
</head>
<body>
<div th:replace="include/top"></div>
<section>
    <br>
    <div align="center">

<div class="prdDetails">
    <div class="prdDetails">
        <div class="sangjwa">
            <img th:src="@{/img/}+${product.pimgStr}" width="100%" />
        </div>        
        <div class="sangu">
        
        	<!-- ì¥ë°”êµ¬ë‹ˆ form -------------------------------------------------------------->        	
            <form action="/cart/addCart" method="post">
                <input type="hidden" name="product_code" th:value="${product.product_code}">
                <div>
                    <strong th:text="${product.pname}"></strong>
                    <small th:text="${product.pdesc}"></small>                    
                </div>
                
                <div>
					<span class="material-symbols-outlined" style="color: #999;">
					sell
					</span>
				
                    <input type="hidden" name="pprice" th:value="${product.pprice}">  
                    <span th:text="${product.fmtPprice} + 'ì›'"></span>
                </div>
                
                <div>
                <span class="material-symbols-outlined" style="color: #999;">
				local_shipping
				</span>
                    <input type="hidden" name="pdelifee" th:value="${product.pdelifee}">
                    <span th:text="${product.pdelifee == 0 ? 'ë¬´ë£Œë°°ì†¡' : product.fmtPdelifee + 'ì›'}"></span>
                </div>
                                
                <div class="total-price">
                    <input type="hidden" name="hab" id="habInput" 
                    th:value="${product.pprice * product.pquantity + product.pdelifee}">
                    <span id="habText"></span>
                </div>
				
				<div>
                ì£¼ë¬¸ìˆ˜ëŸ‰:
                <input type="number" name="pquantity" class="quantity-input" 
                th:value="${product.pquantity}" th:text="'/ ìµœëŒ€ ' + ${product.pstock} + 'ê°œ'"  min="1" th:max="${product.pstock}">
				</div>
				
				<input type="hidden" th:value="${product.category}">
				<a th:text="'#' + ${product.category}"  
				th:href="@{/prd/prdListByCtgr(category=${product.category})}"></a>
				                
                <input type="hidden" name="uid" th:value="${session.username}">
                
				<!-- ì‚¬ìš©ì ë¡œê·¸ì¸ ì¤‘ì¸ ê²½ìš° ë°”ë¡œ êµ¬ë§¤ ê°€ëŠ¥ -->
                <div style="margin-top: 50px;"
                 th:if="${session.username != null and session.loginType == 'user'}">
                	 <button type="submit" class="button">ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸°</button>&emsp;
                     <button type="button" class="subbtn">ë°”ë¡œ êµ¬ë§¤</button>                        
                </div>
			</form><!-- ì¥ë°”êµ¬ë‹ˆ form ë ----------------------------------------------------------------------------->
               
                <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ ë˜ëŠ” ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° ë¨¼ì € ë¡œê·¸ì¸í•˜ë„ë¡ -->
			<div style="margin-top: 50px;"
              th:unless="${session.username != null and session.loginType == 'user'}">
                 êµ¬ë§¤í•˜ì‹¤ ê²½ìš° ì‚¬ìš©ì ê³„ì • <span style="font-weight: bold;">ë¡œê·¸ì¸</span> ë˜ëŠ” <span style="font-weight: bold;">íšŒì›ê°€ì…</span>ì´ í•„ìš”í•©ë‹ˆë‹¤.
                 <br>
                 <button type="button" class="button" onclick="location.href='/login/loginForm'">ë¡œê·¸ì¸</button>
                 &emsp;
                 <button type="button" class="subbtn" onclick="location.href='/user/joinForm'">íšŒì›ê°€ì…</button>
    	 	</div><!-- ë¡œê·¸ì¸ ê´€ë ¨ ë -->
        </div> <!-- sangu ë -->
    </div>  <!-- sangdan ë -->
    
<div class="separator-horizontal"></div> <!------------------------- ìˆ˜í‰ì„  -------------------------->
        
    <div style="width: 800px;"><!-- pdetail -->
    	<div th:if="${product.pdetail != null} and !${product.pdetail.isEmpty()}">
	        <div th:utext="${product.pdetail}"></div> <!-- `utext`ë¥¼ ì‚¬ìš©í•˜ì—¬ HTML íƒœê·¸ë„ ë Œë”ë§ -->
	        <div class="separator-horizontal"></div> <!------------------------- ìˆ˜í‰ì„  -------------------------->
        </div>
    </div><!-- pdetail ë -->
  
</div> <!-- prdDetails ë -->
    
<h3 th:text="'í›„ê¸° (' + ${revListSize} + 'ê±´)'"></h3>

	<div th:if="${session.username != null and session.loginType == 'user'}" class="rvDiv">
		<button type="button" class="addPrdBtn" onclick="location.href='/review/reviewable'">
		â• í›„ê¸° ì‘ì„±</button>
    </div>    

<div th:if="${reviewList != null && !reviewList.isEmpty()}"><!-- li null/empty ì—¬ë¶€ -->
	<!--     í›„ê¸° -->
	<div class="allRv">
		<!--     ê° í›„ê¸° -->
	    <div th:each="rv : ${reviewList}" style="margin-bottom: 20px;">
	    
		    <div class="basicInfo2">
			    <div style="width: 85%;">
				    <strong th:text="${rv.uname}+'ë‹˜:'"></strong>
				 </div>
				 
				 <div style="width: 15%; display: flex; justify-content: flex-end;">
				 	<small th:text="${rv.rdate}"></small>
				 </div>
		     </div>
		     
		     <div style="background-color: #e7e7e7; padding: 20px; border-radius: 5px;">
				<div th:utext="${rv.rcontent}" class="rcontent"></div>
		     </div>	     
	    </div><!-- ê° í›„ê¸° ë -->   
	</div><!-- í›„ê¸° ë -->	
</div><!-- li null/empty ì—¬ë¶€ ë -->

<div th:if="${rcmList != null && !rcmList.isEmpty()}"><!-- li null/empty ì—¬ë¶€ -->
<!-- ì¶”ì²œ -->
<div class="rcm">
	<div class="separator-horizontal"></div> <!------------------------- ìˆ˜í‰ì„  -------------------------->

	<div style="width: 100%;">
		<div th:if="${session.username != null and session.loginType == 'user'}">
		    <span th:text="${session.username} + 'ë‹˜,'"></span>
		</div>
		<h3 style="margin-top: 0px;">ì´ëŸ° ìƒí’ˆì´ ì–´ë–¨ê¹Œìš”?</h3>
	</div>

    <div th:each="rcmP : ${rcmList}" class="eachPrdCtn">
    
        <input type="hidden" name="product_code" th:value="${rcmP.product_code}">
        
        <div class="imgCtn">         
	        <a th:href="@{/prd/viewPrd(product_code=${rcmP.product_code})}">
	            <img th:src="@{/img/}+${rcmP.pimgStr}" width="100%" />
	        </a>
        </div>
        
        <a th:href="@{/prd/viewPrd(product_code=${rcmP.product_code})}" 
        th:utext="'<strong>' + ${rcmP.pname} + '</strong>'">
		</a>
       
        <div class="basicInfo2"><!-- ê°€ê²© + í›„ê¸°ê±´ìˆ˜ + ğŸ›’ ë²„íŠ¼ -->
        
	        <div style="width: 50%; display: flex;" th:text="${rcmP.fmtPprice} + 'ì›'"></div>&emsp;	        
	        
	        <div style="width: 25%;" th:if="${rcmP.reviewCount > 0}">
			    <span class="material-symbols-outlined iconBtn3">tooltip</span>
			    <span th:text="${rcmP.reviewCount}"></span>
			</div>
	        <!-- ë¬¸ì ì•„ë‹Œ intì´ê¸°ì— !=null ì¡°ê±´ í•„ìš”x -->
	    </div><!-- ê°€ê²© + í›„ê¸°ê±´ìˆ˜ + ğŸ›’ ë²„íŠ¼ ë -->             
        <div th:if="${rcmP.pdelifee == 0}" th:text="'ë¬´ë£Œë°°ì†¡'"></div>        
    </div> <!-- eachPrdCtn ë -->
</div> <!-- allPrdCtn ë -->
<!-- ì¶”ì²œ ë -->
</div><!-- li null/empty ì—¬ë¶€ ë -->

        <br>
    </div>
</section>
<div th:replace="include/bottom::footer"></div>

<script>
//ê²°ì œì•¡ ë¯¸ë¦¬ ê³„ì‚°
document.addEventListener('DOMContentLoaded', function() {	
	//HTML ìš”ì†Œ ì¤‘ ì…ë ¥ê°’ ì„ íƒí•´ ë³€ìˆ˜ì— ì €ì¥
    const quantityInput = document.querySelector('.quantity-input');	
	const priceInput = document.querySelector('input[name="pprice"]');
    const deliveryFeeInput = document.querySelector('input[name="pdelifee"]');
    
    //ìœ„ì˜ ì…ë ¥ê°’ì„ ìˆ«ìë¡œ ë³€í™˜ í›„ ì—°ì‚° ì‹œ ì´ìš©í•  ê°’ì˜ ë³€ìˆ˜ëª… ì„ ì–¸
    const price = parseFloat(priceInput.value);
    const deliveryFee = parseFloat(deliveryFeeInput.value);
    
    //ì¶œë ¥ê°’ ì„ ì–¸
    const habInput = document.getElementById('habInput'); //ì €ì¥ê°’
    const habText = document.getElementById('habText'); //í‘œì‹œê°’
    
    //ì…ì¶œë ¥ê°’ ì œëŒ€ë¡œ ì°íˆëŠ”ì§€ í™•ì¸    
    console.log('priceInput:', priceInput);
    console.log('deliveryFeeInput:', deliveryFeeInput);
    console.log('quantityInput:', quantityInput);
    console.log('habInput:', habInput);
    console.log('habText:', habText);
    
    // ì²œì›ë‹¨ìœ„ì— ì½¤ë§ˆ ì°ê¸°
    function formatNumber(number) {
        return number.toLocaleString();
    }

    // ê³„ì‚°í•˜ê¸°
    function updateTotal() {
        const quantity = parseInt(quantityInput.value, 10);
        const total = (price * quantity) + deliveryFee;
        habInput.value = total;
        habText.innerHTML = 'ì˜ˆìƒê²°ì œì•¡: <strong>' + formatNumber(total) + 'ì›</strong>';
    }

    // ì´ˆê¸° í•©ê³„ ê³„ì‚°
    updateTotal();

    // ì£¼ë¬¸ ìˆ˜ëŸ‰ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ í•©ê³„ ì—…ë°ì´íŠ¸
    quantityInput.addEventListener('input', updateTotal);
});
</script>

</body>
</html>
